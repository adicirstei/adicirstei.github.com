<!DOCTYPE html><html class="no-hjs"><head><meta charset="utf-8"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui"><meta http-equiv="cleartype" content="on"><meta name="msapplication-TileImage" content="/images/touch/apple-touch-icon-144x144-precomposed.png"><meta name="msapplication-TileColor" content="#222222"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content=""><title>adicirstei/blog/Using syntax highlight at build time</title><meta name="description" content="adicirstei home page and blog and;When you build websites with mobile devices in mind you must consider lowering the amount of work you set them do. On my ancient iPhone 3G phone I, quite often, encounter web sites that broke the browser. This is because of theamount of memory they required. When building my statically generated blog, being a programmer, naturally, I considered including code snipets in my blog posts as you will see in the current one. Then, having to wait to javascript to download and run in order to do the syntax highlighting, it downed on me that I all that parsing and tagging work can be done at build timeand theres no need to do the same work on every device that access my website.; Using syntax highlight at build time"><link rel="stylesheet" href="/styles/style.css"><link rel="stylesheet" href="/styles/desktop.css" media="(min-width: 48em)"><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
  ga('create', 'UA-3192288-13', 'adicirstei.github.io');
  ga('send', 'pageview');</script></head><body><header><h1>adicirstei</h1><p>backend developer</p><a href="#" class="navtoggle">toggle</a><nav><ul><!--input(type='text')--><li><a href="/#about-me" class="menuitem">about</a></li><li><a href="/posts/" class="menuitem">blog</a></li><li><a href="/" class="menuitem">home</a></li><li><a href="/games/" class="menuitem">games</a></li></ul></nav></header><section><article><date>2014-07-22</date><h2 id="using-syntax-highlight-at-build-time">Using syntax highlight at build time</h2>
<p>When you build websites with mobile devices in mind you must consider lowering the amount of work you set them do. 
On my ancient iPhone 3G phone I, quite often, encounter web sites that broke the browser. This is because of the
amount of memory they required. When building my statically generated blog, being a programmer, naturally, I considered 
including code snipets in my blog posts as you will see in the current one. Then, having to wait to javascript to 
download and run in order to do the syntax highlighting, it downed on me that I all that parsing and tagging work can be done at build time
and there&#39;s no need to do the same work on every device that access my website.</p>
<h3 id="but-let-s-go-into-the-solution-">But let&#39;s go into the solution.</h3>
<p>I am writing my blog posts in <code>markdown</code>. And am using <a href="http://highlightjs.org/">highlight.js</a> for syntax highliting. 
What <code>highlight.js</code> does? It is taking a piece of <code>html</code> and tag it with spans with specific classes. For example the html bellow is enhanced as 
you can see in the next code snipet.</p>
<p><code>before</code></p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">pre</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">code</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"lang-javascript"</span>&gt;</span>
function add (a, b) {
  return a+b;
}
<span class="hljs-tag">&lt;/<span class="hljs-title">code</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">pre</span>&gt;</span>
</code></pre>
<p><code>after</code></p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">pre</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">code</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"lang-javascript"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"hljs-function"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"hljs-keyword"</span>&gt;</span>function<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"hljs-title"</span>&gt;</span>add<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"hljs-params"</span>&gt;</span>(a, b)<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span> {
  <span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"hljs-keyword"</span>&gt;</span>return<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span> a+b;
}
<span class="hljs-tag">&lt;/<span class="hljs-title">code</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">pre</span>&gt;</span>
</code></pre>
<p>Using this on client side will require some DOM querying and DOM update, then a repaint to apply the accompanying styles. </p>
<p>As I said before, the part that is doing the tagging is unnecesary browser work if you have control on the html creation.</p>
<p>The <a href="https://github.com/chjj/marked/">marked</a> node module is offering the posibility to hook your own syntax highlighting in the process. This can be done 
by passing to the <code>highlight</code> option a function that is doing the tagging as you can see bellow.</p>
<pre><code class="lang-javascript">marked.setOptions({
  highlight: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(code, lang)</span> </span>{
    <span class="hljs-keyword">var</span> hl = <span class="hljs-built_in">require</span>(<span class="hljs-string">'highlight.js'</span>);
    <span class="hljs-keyword">if</span> (hl.getLanguage(lang)) {
      <span class="hljs-keyword">return</span> hl.highlight(lang, code).value;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> hl.highlightAuto(code).value;
    }
  }
});
</code></pre>
<p>In order to avoid the wrong language detection when I try to highlight a language that is not supported, I call selectively <code>highlight</code> or <code>highlightAuto</code> functions.</p>
<h3 id="benefits">Benefits</h3>
<p>Besides the memory and processing power on client device, I discussed at the beggining, another huge benefit comes from reducing the javascript download size with 
13KB miniffied and maybe another server request.</p>
</article></section><section></section><section><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- mobile-blog--><ins style="display:inline-block;width:320px;height:100px" data-ad-client="ca-pub-3072953611703815" data-ad-slot="9331535485" class="adsbygoogle"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});
</script></section><footer><p>Project maintained by<a href="https://github.com/adicirstei">adicirstei</a></p></footer><script src="/scripts/app.js"></script></body></html>